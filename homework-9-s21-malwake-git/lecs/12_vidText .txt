Now that we understand the workings of CSMA we look to quantify its throughput like we did for ALOHA previously.

CSMA and WiFi DCF is not particularly easy to model, because collisions depend on the actions of each station, and also the history of binary exponential backoff coupled with the transmission decisions at each timeslot.

A well known performance model uses a two dimensional markov chain analysis, and that's a bit complicated for our purposes here. But there's a simpler version that uses basic probability theory and a bit of handwaving to get the gist of the complicated derivation. And that's what we're going to look at in the remainder of this lecture before we wrap up in trying to quantify throughput and seeing how well it scales as we add more devices to a hotspot.

So the main idea is to find two different expressions that relate the probability of transmission at a given timeslot with the probability of collision and then to solve for both probabilities through these two equations. Then computing the throughput will become easy. So let's walk through and see where that comes out.

The expected throughput S for CSMA random access is defined as S equals the average number of bits transmitted successfully in a timeslot divided by the average length of a timeslot.

So this is the expected throughput and it will be measured in bits per second, because it's giving the average number of bits we can expect successfully in a timeslot over the average length of a timeslot. Now remember when we looked at Aloha we had the total throughput as a percentage between 0 and 1, but we could easily divide by the ideal throughput to convert this, so if we know the channel supports a certain amount we could divide by the channel capacity to find the probability between 0 and 1.

So first we're going to example the average number of bits transmitted successfully in a timeslot. That can be expressed as the product of three numbers: Pt times Ps times L. Here, Pt is the probability that there is at least one transmission, and there could be more, but this is the probability that there is at least one transmission going on. Ps is the probability that a transmission is successful. And L is the average payload length. And that could be measured in either bytes or bits depending on what's more convenient and what comes out more conveniently in the calculations. And by the way the payload is the actual data component that we are getting through. It's everything minus all the control message and messaging that's going on. The payload is the actual message we want to send to the receiver.

So if we let tau be the probability that any station transmits at a given timeslot, then we know that we can express Pt or the probability that there is at least one transmission, equal to 1 - 1 - tau to the N, given that there's N stations. Because Pt is going to be equal to 1 minus the probability that no station transmits, which is in turn the product of the probabilities that each station is not going to transmit, 1 - tau over all the stations. And this assumes that all stations are going to make their transmission decisions independent of one another. So let's summarize here that tau equals probability that any station transmits.

So we also know that the probability of a successful transmission, or Ps times Pt because Ps is the probability that a transmission is successful and Pt is the probability that we have at least one transmission to begin with equals N times tau times 1 - tau to the N - 1 power. And this is due to the fact that the left hand side again is the probability that there is a successful transmission at a given timeslot. And for each station that should be the probability that it transmits, which is tau, and that none of the other stations does, and that's 1 - tau to the N - 1. And for the whole network we multiply by N. This equation should look very familiar to the total throughput we saw for Aloha, because it's the same exact thing, if we replace tau with the p we were using before.

So now we're going to examine the average length of a timeslot. And that's going to depend on what exactly happens in the timeslot. So there are three possibilities. One is that there is no transmission at all, and that probability is going to be 1 - Pt. The second chance is that there is an unsuccessful transmission, so there is a transmission but it's not successful. The probability of that is Pt times 1 - Ps. And the third possibility is that there is a transmission and it is successful, and that probability as we just said is Pt times Ps. And we also want to know what the length of each of these timeslots would be, because then we can find the expected length of the full timeslot by multiplying the probabilities that each of those timeslots happens with the length of the timeslot given that actually did happen.

So then we want to know what the lengths would look like for these. And for no transmission, the timeslot will be a backoff slot with Tb which is the time it takes to do backoff. For an unsuccessful transmission its going to be a collision timeslot, or Tc, the time it takes for a collision. And for a successful transmission its going to be the time for a successful transmission, or we'll say Ts.

If we refer back to this figure which we saw much earlier when we were explaining the basics of CSMAs operation, Ts is the total time of the data frame, the SIFS, the acknowledgment frame, and also the following DIFS, because that's the time it takes for this first data to actually get fully cycled through before we send the next data.

What about Tc, a collision time? Well it turns out that in order for a station to realize a collision has occurred, it must wait for the full duration of the ACK frame anyway, because a station is not going to know that there's been a collision and it's time to back off until it knows that an acknowledgment did not actually come back. So really, Tc equals Ts. The timeslot length of a collision timeslot is the same as the timeslot length of a successful transmission. And then Tb is the backoff timeslot length which we will compute later.

So in summary if we know how to compute tau, and that's a big if because we are going to have to figure out how to compute that, we can compute Pt as well as Ps using the formulas we saw before and that's the expected total throughput S is going to be equal to Pt times Ps times L over 1 - Pt times Tb for a backoff timeslot + Pt times 1 - Ps Tc + PtPsTs, and again we have that Ts equals Tc and we can make the substitution for that at any point.

So at the top here we have the number of bits that are going to be transmitted successfully, and at the bottom we have the expected length of that timeslot.

Among quantities shown here, N, L, Tb, Tc, and Ts are constants. N appears here because the different transmission probabilities will depend on that. So we just have to compute tau, tau is really the key here. Once we have an expression for computing tau everything else kind of comes together.

So how do we go about computing the probability of transmission tau? First we can express c, which is the probability that a frame transmitted by a particular station say station A collides with another station as a function of tau. We have to assume the collision probability is independent of the backoff stage, and if we do that we can write c which is again the probability that a frame collides with frames from other stations equals 1 - 1 - tau raised to the N - 1 power. Because remember c is simply the probability that at least one, or it could be more of the other N - 1 stations transmits in addition to station A. So if A is already transmitting, 1 - tau is the probability that a station does not transmit, so 1 - tau raised to the N - 1 is the probability that all of the other stations do not transmit, and 1 minus that is the probability that at least one of the other stations will transmit. At least one of the other stations transmits.

So now suppose we can do the reverse, and we can express tau as a function of c. So right now we have c as a function of tau and suppose we can say tau is some function of c. In that case we'd be able to substitute c as a function of tau and numerically solve for tau. So now everything boils down to the following. We need to find tau, the probability that a station transmits, as a function of c, the probability that a transmitted station collides. tau is the probability transmit, c is the probability of colliding.

Now since there's many backoff stages indexed by i, each with a contention window doubling from the previous stages because remember, in the ith backoff stage we're going to be double what the i - 1 backoff stage was whatever the contention window is, we're going to look at the joint probability that a station transmits successfully while at backoff stage i. Or we can write that more succinctly as we're going to look at the probability that a station transmits and its in backoff stage i, and means these events happen together. So from basic conditional probability, or Bayes rule, we know that for any two events A and B, there's two ways of expressing the probability of A and B. We can express this as the probability of A occurring given B has already occurred times the probability of B, and also as the probability that B occurs given A has already occurred times the probability of A occurring. And the probability B and the probability A are unconditional probabilities.

So therefore we can express the joint probability of transmit and in backoff stage i in two ways. The first way is probability transmit times the probability in backoff stage i given that we're transmitting. And second, the probability that we're in backoff stage i times the probability that we're transmitting given that we're in backoff stage i.

So if we give shorthands notations to these expressions, we can call this one tau times the probability of i given tau. Probability of transmitting times the probability we're in backoff stage i given that we're transmitting. And this one would be the probability of i of being in backoff stage i times the probability of T given i. So therefore, since these two things have to be equal, we get the following Bayesian expression. tau times P i given T over P T given i equals P of i the probability that we're in backoff stage i. And this down here this should actually be P of i given T instead of P of i given tau.

Now if we sum over all of the i from 0 meaning from no backoff to B which is the maximum number of backoffs allowed on both sides, then we get the following expression. We get tau times the sum from i equals 0 to B of P of i given T over P of T given i equals the sum from i equals 0 to B of P of i and that all has to be equal to 1. And the reason that it sums to 1 is that we must be in at least one of the backoff stages. So the sum from i equals 0 to B of P of i or the probability we are in any backoff stage has to be 1. So now if we can express P of i given T and P of T given i in terms of c, then we have an expression for tau in terms of c, which completes our derivation of S.

So we did a little handwaving here, but the general flow we have these two events and we are analyzing their joint probabilities here, then this is the probability equations we have for them in terms of Bayes formula, we write them in shorthand notation, then using this shorthand notation we come back all the way up here and we start by then putting these together and combining them, and then from that we sum from i equals 0 to B and it simplified to the following formula.

So computing P i given T is easy. If the station transmits at the backoff stage i, it must have suffered i collisions in the past and one non-collision now. So that's c to the i times 1 - c meaning we have one non-collision now and i collisions in the past. We can write this as a probability making sure it's normalized. We can write P i given T equals c i times 1 - c and we have to divide that by 1 - c to the B+1 because this is a geometric sum, or a B+1 geometric term sum. If you want to see why that is we can take the sum from i equals 0 to B of 1 - c times ci equals 1 - c times the sum from i equals 0 to B of c to the i equals 1 - c times 1 - c to the B+1 over 1 - c, and that's by the definition of the B+1 term geometric sum, and that comes out to 1 - c to the B+1, because these cancel out, and so we have to divide this expression by 1 - c to the B+1 to make sure its normalized.

To compute P of T given i, we can use something called the long-run renewable rate theorem. Without going into details because it does get a bit complicated, this tells us that the probability of transmitting at any given timeslot is inversely proportional to the expected number of slots spent by the station during the whole cycle. Since the transmit slot is one slot on its own, the lifetime of backoff stage i on average is going to be 1 + Ti slots. And here, Ti is the average value of the backoff counter. Ti is the average value of the backoff counter at stage i and therefore we can express Ti as one half times 0 + 2 to the i times Wmin. And the reason for that is remember when we choose the backoff counter at any given stage, we are going to be choosing randomly between 0 and whatever the maximum value of the backoff window could be. Technically it should be 2 i Wmin - 1, but we are going to ignore the fact that we have to subtract by 1 for simplicity. And so the average of that, given that we are choosing uniformly at random is just going to be one half of the distance between those, so the average value is just half of the range.

And as obvious from the above, we have assumed that the timeslot to transmit is picked randomly between right now and the upper limit of binary exponential backoff. So as a result, we are going to get that P of T given i is 1 over 1 + Ti. Remember because the lifetime of the backoff counter at stage i is going to be 1 + Ti, which then from our formula for Ti is going to be 1 over 1 + 2 to the i-1 Wmin. And this i - 1 comes from the fact that we are dividing by two here.

Finally we can put everything back together and have the following expression of tau in terms of c. tau equals 1 over the sum over i P i given T over P T given i which equals 1 over sum over i of 1 - c times ci over 1 - c to the B + 1 times 1 + Ti which equals in turn 1 over 1 + 1 - c over 1 - c to the B+1 times the sum of the i's ci times Ti. And this 1 in the denominator here comes from the fact that the sum of i of P i given T over all i is going to be equal to 1. And so this 1 in here multiplied by this term this is giving us the expression for P i given T and that sum should be 1 so it simplifies to this, so this is our final expression for tau as a function of c.

And again if this step seems a little strange to you in how exactly we get that P of T given i equals 1 over 1 + Ti, well this is just from the long run renewable rate theorem and you can take a look at that in some more detail if you're interested, but you should understand how to compute the value of Ti here, it's one half of the range of possible backoff counters. And then that simplifies to this.

So now, if we use this equation for tau in terms of c, and our prior equation for c in terms of tau, we can plug them into each other and solve for tau numerically, as a function of the number of backoff stages B and the minimum contention window size Wmin, and those will all be specified in the exact implementation of CSMA that we are using. Then once tau is found, we can find Pt and Ps as well, which we looked at previously, the probability of transmitting and the probability of successful transmission, and then we can compute the throughput in terms of the DCF protocol parameters, L being the payload length, B being the maximum number of backoff stages, Wmin being the minimum contention window size, and the lengths of the three types of timeslots, Tb is the backoff slot, Tc is the collision slot, and Ts is a successful transmission slot, and also the number of stations N.

So next we're going to look at actually computing this for a couple different case studies of parameters and see how the throughput varies as N changes, which is what we've been trying to build up to the whole time.