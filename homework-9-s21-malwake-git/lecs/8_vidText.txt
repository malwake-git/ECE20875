So we just introduced the concept of CSMA backoff. More precisely the contention window in CSMA works as follows.

Upon failing to receive an acknowledgment, and of course that's after a shorter wait and listen period that a transmitter has to wait before he would receive an acknowledgment, a station will double its contention window size, so roughly speaking if 2 to the w - 1 is the previous size, then that means the next size is 2 to the w + 1 - 1. The station will then choose a random number between 0 and the current contention window to be the initial backoff counter. So it's going to choose a random number between 0 and 2 to the w - 1.

And for example if 2 to the w + 1 - 1 is 15, then this would be a number between 0 and 15, which could be any value. 0 would mean retransmit immediately, and 8 would mean we have to wait 8 timeslots before we have the opportunity to retransmit.

So after observing a longer wait and listen period or a DIFS period, the station will begin to count down from this initial backoff counter, so if the initial backoff counter was say 12 that we chose, it will start to count down, to 11, to 10, and so forth. But it's only going to do do that, it's only going to decrement the counter at each timeslot where the channel is not sensed as being busy. So if we have a number of timeslots if the station senses it's not busy here, maybe it started at 12 then it will go to 11, if it senses its not busy it will go to 10 if it senses it's not busy it will go to 9 and so forth. But if the channel is sensed as busy during any one timeslot say we're in this timeslot and the channel becomes busy, then we have to halt the countdown, we have to halt at the value of 9 in this example, and we have to observe another DIFS period before we can begin counting down and decrementing again. So then we would hold steady until another DIFS period passes, and then we can start counting down again, if the channel is idle we decrement to 8 and so forth.

Once the counter reaches 0, that's when the station will retransmit. If the transmission is successful, then we'll reset the contention window down to its minimum size, whatever it was before we started this contention period, if not then the process will repeat, and the current contention window is going to be 2 to the w + 1 - 1 so we would increase it to 2 to the w + 2 - 1. But again we can only decrement the counter when the channel is sensed as being idle, and in-between those when we do sense something as not being idle we have to observe a whole DIFS period and then we can start decrementing again when the channel is actually idle.

This figure gives an example of this process for two contending stations A and B, A and B are both trying to send to some access point, so to start off both stations A and B start with contention windows of 3 which is 2 squared - 1 they both have the same size. They both attempt to transmit some data, so they both send data, and then after a SIFS period they would expect to receive an acknowledgment back. But it turns out that neither of them do receive an acknowledgment so then they are going to backoff. They both increased contention window to in this case 2 cubed - 1 which is 7 in both cases it is 7 that they back off to, and then they choose a random number between 0 and 7 which is going to be the time they are going to have to wait before transmitting again. And each station happens to draw 3 as the random number. So 3 happens to be the value of the backoff counter they choose. So each station is going to decrement the counter by 1 each period, sensing as idle in this period it decrements to 2, then decrement to 1, then to 0, and they both try to retransmit again. After SIFS period then they observe no acknowledgment again so they know that another collision occurred. So what are they going to do, they are going to backoff again. They back off to 2 to the fourth - 1 which is 15, again they both have 15 as their windows now. But this time they choose different random numbers to back off by. So A chooses 11 as its initial counter and B chooses 6 as its initial counter. Then both stations begin counting down. Senses its idle decrements by 1, senses its idle again and this process keeps continuing. Then B reaches 0 after 6 idle timeslots and it begins to retransmit its data. And then upon a SIFS period it gets an acknowledgment back, so it knows that everything went OK. Now during this time that B is transmitting, A is going to be able to sense that the channel is busy, so its going to hold off at decrementing, it only got down to the value of 5 before this happened, so now it's going to have to hold off and not decrement at all. And then it has to observe a full DIFS period before it can start backing off again. Once that DIFS period passes it decrements down to 4, 3, 2, 1, 0 and eventually it also retransmits. And at this point at well, once B gets its acknowledgment back, it's going to reset its contention window. And then A it turns out observes another collision here, so maybe the conditions happen to be bad and someone else decides to transmit at the same time again, could have been B could have been some other station potentially. So A will back off again, to 2 to the 5 - 1 equals 31 and go through that process again.